# iOS Simulator MCP Integration

This project includes an MCP server that captures iOS simulator screenshots for AI analysis and provides automated visual feedback during React Native development.

## Quick Start Workflow

### First Time Setup
1. **Verify Setup**: Use `verify_setup` tool to check all dependencies
2. **Check Simulator**: Use `get_simulator_status` to see if simulator is running
3. **Boot if Needed**: Use `boot_simulator` to start simulator automatically if not running
4. **Capture**: Use `capture_simulator_screenshot` to test the system

### Standard Development Workflow
1. Make UI changes in your React Native code
2. Save files → Auto-capture takes screenshot after 2 seconds (if enabled)
3. View latest screenshot automatically in conversation
4. Get AI feedback on visual changes, layout, styling
5. Compare before/after using `compare_screenshots`

## Available MCP Tools (9 Total)

### Essential Tools (Use First)
- **`get_simulator_status`** - Check if iOS simulator is running. Always use this FIRST before capturing screenshots. Returns actionable suggestions if simulator is not running.
- **`verify_setup`** - Verify Xcode, simctl, and all dependencies. Use when troubleshooting or for initial setup verification.

### Screenshot Capture
- **`capture_simulator_screenshot`** - Manually capture and display screenshot immediately. Use after making UI changes or when you need to see current state.
  - Optional: Add description for context (e.g., "after button styling changes")
  - Screenshot appears directly in conversation
  - Prerequisites: Simulator must be booted

### Screenshot Management
- **`list_recent_screenshots`** - Browse recent screenshots with metadata, timestamps, and what triggered each capture
  - Default: 5 screenshots, max: 20
  - Shows file changes and suggestions for each
  - Use to find specific screenshot before analysis

- **`compare_screenshots`** - Compare two screenshots side-by-side with difference analysis
  - Requires timestamps from screenshot history
  - Shows both images plus metadata differences
  - Ideal for before/after comparisons

### Automation Control
- **`toggle_auto_capture`** - Enable/disable automatic screenshot capture on file saves
  - When enabled: Screenshots taken 2 seconds after saving UI files
  - Watches: components/, screens/, views/, pages/, app/, src/ directories
  - Use when: Want hands-free screenshot tracking during development
  - Disable when: Making non-visual changes or don't want frequent screenshots

### File Watcher
- **`get_watcher_status`** - Get file watcher status with recent file changes
  - Shows last 10 file changes with timestamps
  - Displays watch patterns and current configuration
  - Use to debug why auto-capture isn't triggering

### Simulator Control
- **`boot_simulator`** - Start iOS simulator automatically if not running
  - Optional: Specify device name (e.g., "iPhone 16 Pro")
  - Default: Boots latest available iPhone
  - Use when simulator status shows no booted device

### Maintenance
- **`clear_screenshots`** - Delete all captured screenshots to free up disk space
  - Removes all files from .emcap-screenshots directory
  - Clears file change history
  - Use with caution - this is permanent
  - Good for: starting fresh, freeing disk space, cleaning up after long sessions

## Available MCP Resources

- **`simulator://latest-screenshot`** - Most recent screenshot with metadata
  - Includes: timestamp, device info, trigger reason, file changes, AI suggestions
  - Updates automatically when new screenshots are captured

- **`simulator://screenshot-history`** - Complete JSON history of all screenshots
  - Includes: all metadata, file changes, devices, triggers
  - Use for programmatic access or detailed analysis

- **`simulator://screenshot/{timestamp}`** - Specific screenshot by timestamp
  - Access any historical screenshot directly
  - Timestamps available from list_recent_screenshots

## Tool Usage Decision Tree

```
Starting Development Session:
└─> verify_setup (if first time or having issues)
    └─> get_simulator_status
        ├─> [Not Running] → boot_simulator
        │   └─> capture_simulator_screenshot (test)
        └─> [Running] → capture_simulator_screenshot

Making UI Changes:
└─> Enable auto-capture: toggle_auto_capture(true)
    └─> Edit UI files
        └─> Save → Auto-screenshot captured
            └─> Review in conversation
                └─> Make more changes or compare_screenshots

Analyzing Changes:
└─> list_recent_screenshots
    └─> Pick two timestamps
        └─> compare_screenshots(timestamp1, timestamp2)
            └─> Review differences

Troubleshooting:
└─> get_simulator_status (check if running)
    ├─> [Not Running] → boot_simulator
    └─> [Running] → get_watcher_status
        └─> Check if files are being watched
            └─> verify_setup (check dependencies)
```

## AI Analysis Capabilities

When analyzing screenshots, the AI can provide feedback on:

### Visual Issues
- Layout problems (overlapping, misalignment, spacing)
- Color inconsistencies
- Font size/weight issues
- Image rendering problems
- Component visibility

### UI/UX Review
- Accessibility concerns (contrast, touch targets)
- Navigation flow issues
- Consistency with design systems
- User experience improvements
- Responsive design issues

### Verification
- Implementation matches design mockups
- Changes appear correctly after code modifications
- Cross-component consistency
- Brand guideline adherence

### Suggestions
- Alternative layout approaches
- Styling improvements
- Component organization
- Performance-related visual issues

## Context Awareness

The MCP server tracks and provides:
- **File changes**: Last 5 minutes of file modifications
- **Suggestions**: AI-generated suggestions based on changed files
  - Component file changes → Check component rendering
  - Screen file changes → Verify navigation and layout
  - Style file changes → Review colors, spacing, consistency
  - Multiple files → Check consistency across components

## Auto-Capture Behavior

### What Triggers Auto-Capture:
- Saving files in: `components/`, `screens/`, `views/`, `pages/`, `app/`, `src/`
- File extensions: `.tsx`, `.jsx`, `.ts`, `.js`
- Files containing UI keywords: View, Text, Image, Button, etc.

### Timing:
- 2-second debounce delay after file save
- Multiple rapid saves → One screenshot after all changes

### What's Ignored:
- `node_modules/`, `dist/`, `build/`, `.git/`, `android/`
- Test files: `__tests__/`, `*.test.*`, `*.spec.*`

## Best Practices

### For AI:
1. **Always check simulator status first** before attempting screenshots
2. **Use boot_simulator** if simulator is not running (don't just report the issue)
3. **Include screenshot descriptions** when capturing for better tracking
4. **Suggest specific improvements** based on file changes shown in metadata
5. **Use compare_screenshots** when user asks about "what changed" or "before/after"
6. **Reference file changes** in your analysis (shown in screenshot metadata)

### For Users:
1. Keep simulator running during development sessions
2. Use descriptive commit-like messages when manually capturing
3. Enable auto-capture during active UI development
4. Disable auto-capture when working on business logic
5. Use verify_setup if tools start failing

## Troubleshooting Workflows

### "Screenshots not being captured"
1. `get_watcher_status` → Check if watcher is running and enabled
2. `toggle_auto_capture(true)` → Ensure auto-capture is enabled
3. Check file paths → Must be in watched directories
4. `get_simulator_status` → Ensure simulator is running

### "Tool timeouts or hangs"
1. `verify_setup` → Check all dependencies
2. `get_simulator_status` → Verify simulator is responsive
3. Restart simulator → Kill and `boot_simulator`
4. Check Cursor MCP logs (Cmd+Shift+U → select "ios-simulator")

### "Simulator not starting"
1. `verify_setup` → Check Xcode installation
2. `get_simulator_status` → See available devices
3. `boot_simulator("iPhone 16 Pro")` → Try specific device
4. Manual: Open Xcode → Simulator.app

## Example Prompts

### Initial Setup
- "Can you verify my iOS simulator setup?"
- "Check if the simulator is running and start it if needed"

### During Development
- "Capture a screenshot after I save this component"
- "Show me what the login screen looks like now"
- "Enable auto-capture while I work on the UI"

### Analysis
- "Analyze the current screenshot and suggest improvements"
- "Compare the last two screenshots and tell me what changed"
- "List recent screenshots and show me the one from 5 minutes ago"

### Troubleshooting
- "Why aren't screenshots being captured automatically?"
- "What files have changed recently?"
- "Verify that everything is set up correctly"

### Maintenance
- "Clear all screenshots to free up space"
- "Delete all captured screenshots and start fresh"
- "How many screenshots are currently stored?"

## Technical Details

- **Screenshot Storage**: `.emcap-screenshots/` (git-ignored automatically)
- **Max Screenshots**: 50 (older ones auto-deleted)
- **Screenshot Format**: PNG with timestamp in filename
- **Debounce Delay**: 2000ms (2 seconds)
- **Change History**: Last 50 file changes tracked
- **Node Version**: 18+ required
- **OS**: macOS only (iOS simulator requirement)

